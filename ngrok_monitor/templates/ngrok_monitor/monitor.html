<!DOCTYPE html>
<html>
<head>
    <title>Monitor de ngrok</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .status-card {
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }
        .status {
            font-size: 24px;
            margin: 20px 0;
        }
        .running {
            color: green;
        }
        .not-running {
            color: red;
        }
        button {
            background-color: #4CAF50;
            border: none;
            color: white;
            padding: 15px 32px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            margin: 4px 2px;
            cursor: pointer;
            border-radius: 4px;
        }
        .ngrok-url {
            word-break: break-all;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <h1>Monitor de ngrok</h1>
    
    <div class="status-card">
        <h2>Estado actual:</h2>
        <div class="status {% if ngrok_running %}running{% else %}not-running{% endif %}" id="status-text">
            {% if ngrok_running %}
                ngrok está ejecutándose
            {% else %}
                ngrok no está ejecutándose
            {% endif %}
        </div>
        
        {% if ngrok_url %}
            <div class="ngrok-url" id="ngrok-url">
                <strong>URL pública:</strong> <a href="{{ ngrok_url }}" target="_blank">{{ ngrok_url }}</a>
            </div>
        {% endif %}
        
        {% if not ngrok_running %}
            <form method="post">
                {% csrf_token %}
                <button type="submit" name="start_ngrok">Iniciar ngrok</button>
            </form>
        {% endif %}
    </div>

    <script>
        // Actualizar el estado cada 5 segundos
        setInterval(function() {
            fetch('/check-status/')
                .then(response => response.json())
                .then(data => {
                    const statusEl = document.getElementById('status-text');
                    const urlContainer = document.getElementById('ngrok-url');
                    
                    if (data.running) {
                        statusEl.textContent = 'ngrok está ejecutándose';
                        statusEl.className = 'status running';
                        
                        if (data.url) {
                            if (!urlContainer) {
                                const div = document.createElement('div');
                                div.id = 'ngrok-url';
                                div.className = 'ngrok-url';
                                div.innerHTML = `<strong>URL pública:</strong> <a href="${data.url}" target="_blank">${data.url}</a>`;
                                document.querySelector('.status-card').appendChild(div);
                            } else {
                                urlContainer.innerHTML = `<strong>URL pública:</strong> <a href="${data.url}" target="_blank">${data.url}</a>`;
                            }
                        }
                        
                        // Ocultar el botón si ngrok está corriendo
                        const form = document.querySelector('form');
                        if (form) form.style.display = 'none';
                    } else {
                        statusEl.textContent = 'ngrok no está ejecutándose';
                        statusEl.className = 'status not-running';
                        
                        // Mostrar el botón si ngrok no está corriendo
                        const form = document.querySelector('form');
                        if (!form) {
                            const newForm = document.createElement('form');
                            newForm.method = 'post';
                            newForm.innerHTML = '{% csrf_token %}<button type="submit" name="start_ngrok">Iniciar ngrok</button>';
                            document.querySelector('.status-card').appendChild(newForm);
                        } else {
                            form.style.display = 'block';
                        }
                        
                        if (urlContainer) {
                            urlContainer.remove();
                        }
                    }
                });
        }, 5000);
    </script>
</body>
</html>